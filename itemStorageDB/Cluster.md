# ScyllaDB 3-Node Cluster with Docker Compose

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π 3-—É–∑–ª–æ–≤–æ–π –∫–ª–∞—Å—Ç–µ—Ä ScyllaDB —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è e-commerce —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **3-—É–∑–ª–æ–≤–æ–π –∫–ª–∞—Å—Ç–µ—Ä** ScyllaDB —Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
- **–ì–æ—Ç–æ–≤—ã–µ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è e-commerce –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ** –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã
- **–î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —É–∑–ª–∞–º** —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ –ø–æ—Ä—Ç—ã
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker Desktop —Å WSL2 backend
- Windows 10/11 –∏–ª–∏ Linux/macOS
- 4+ GB RAM
- 2+ CPU cores

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <your-repo-url>
cd scylla-cluster
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WSL2 (—Ç–æ–ª—å–∫–æ –¥–ª—è Windows)

```bash
# –ó–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ WSL –æ–∫–Ω–∞
wsl --shutdown

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ WSL2 –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
wsl -u root

# –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç AIO
echo 262144 > /proc/sys/fs/aio-max-nr
echo "fs.aio-max-nr = 262144" >> /etc/sysctl.conf
sysctl -p

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
cat /proc/sys/fs/aio-max-nr
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å 262144
exit
```

### 3. –ó–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞

```bash
# –°–æ–∑–¥–∞–µ–º —Å–µ—Ç—å
docker network create --driver=bridge --subnet=10.5.0.0/16 scylla-net

# –ó–∞–ø—É—Å–∫–∞–µ–º –∫–ª–∞—Å—Ç–µ—Ä
docker-compose up -d

# –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (2-3 –º–∏–Ω—É—Ç—ã)
timeout 180
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞

```bash
docker exec -it scylla-node1 nodetool status
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### Keyspace: `ecommerce`

**–¢–∞–±–ª–∏—Ü—ã:**
- `product_by_id` - –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ ID –ø—Ä–æ–¥—É–∫—Ç–∞
- `products_by_category` - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- `products_by_brand` - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –±—Ä–µ–Ω–¥–∞–º

### –°—Ö–µ–º–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
- **Strategy**: SimpleStrategy
- **Replication Factor**: 3

## üóÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ö–æ–ø–∏—Ä—É–µ–º –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
docker cp init.cql scylla-node1:/tmp/
docker exec -it scylla-node1 cqlsh -f /tmp/init.cql

# –ù–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
docker cp insert_data.cql scylla-node1:/tmp/
docker exec -it scylla-node1 cqlsh -f /tmp/insert_data.cql
```

## üîå –î–æ—Å—Ç—É–ø –∫ —É–∑–ª–∞–º

| –£–∑–µ–ª | CQL –ø–æ—Ä—Ç | API –ø–æ—Ä—Ç | –ö–æ–º–∞–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–∞ |
|------|----------|----------|-----------------|
| Node 1 | 9042 | 19042 | `cqlsh localhost 9042` |
| Node 2 | 9043 | 19043 | `cqlsh localhost 9043` |
| Node 3 | 9044 | 19044 | `cqlsh localhost 9044` |

## üìù –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

```sql
-- –ü–æ–¥—Å—á–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤
SELECT COUNT(*) FROM ecommerce.product_by_id;

-- –ü—Ä–æ–¥—É–∫—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
SELECT category, COUNT(*) as count 
FROM ecommerce.product_by_id 
GROUP BY category;

-- –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
SELECT * FROM ecommerce.products_by_category 
WHERE category = 'electronics';
```

## üßπ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–º

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
docker-compose down

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
docker stop $(docker ps -aq --filter "name=scylla") 2>/dev/null
docker rm $(docker ps -aq --filter "name=scylla") 2>/dev/null
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs
docker logs scylla-node1

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
docker exec -it scylla-node1 nodetool cfstats ecommerce

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–±–ª–∏—Ü–∞—Ö
docker exec -it scylla-node1 nodetool tablestats
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞:
- `--smp 1` - –û–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω—ã–π core –Ω–∞ —É–∑–µ–ª
- `--developer-mode=1` - –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- `--overprovisioned 1` - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
- `SimpleSnitch` - –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –†–µ—Å—É—Ä—Å—ã:
- 1 CPU core –Ω–∞ —É–∑–µ–ª
- 1GB RAM –Ω–∞ —É–∑–µ–ª
- –°–µ—Ç—å: 10.5.0.0/16

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ AIO –≤ WSL2:
```bash
wsl --shutdown
wsl -u root
echo 262144 > /proc/sys/fs/aio-max-nr
exit
```

### –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø–æ—Ä—Ç–æ–≤:
–ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç—ã –≤ `docker-compose.yml` –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é:
```bash
docker network rm scylla-net
docker network create --driver=bridge --subnet=10.5.0.0/16 scylla-net
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–ö–ª–∞—Å—Ç–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏. –î–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

1. –£–≤–µ–ª–∏—á—å—Ç–µ —Ä–µ—Å—É—Ä—Å—ã CPU –∏ RAM
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `NetworkTopologyStrategy` –≤–º–µ—Å—Ç–æ `SimpleStrategy`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `smp` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —è–¥—Ä–∞–º–∏ CPU
4. –£–±–µ—Ä–∏—Ç–µ `--developer-mode=1`

## ü§ù Contributing

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞:

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch
3. Commit –≤–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. Push –≤ branch
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ MIT License.

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [ScyllaDB Documentation](https://docs.scylladb.com/)
- [Docker Compose Documentation](https://docs.docker.com/compose/)
- [CQL Reference](https://cassandra.apache.org/doc/latest/cql/)

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ—Ç –∫–ª–∞—Å—Ç–µ—Ä –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –î–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è.


